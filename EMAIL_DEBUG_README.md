# Email Debugging Tool Documentation\n\nThis documentation explains how to use the email debugging functionality in your trading system.\n\n## Overview\n\nThe email debugging tool provides comprehensive tracking and debugging for email notifications sent from your trading system. It logs all email attempts, tracks success/failure rates, and provides detailed debugging information.\n\n## Features\n\n- ‚úÖ **Email Status Tracking**: Know immediately if emails are sent successfully or failed\n- üìä **Statistics Dashboard**: View success rates and recent email attempts\n- üîß **Configuration Testing**: Verify your email settings before going live\n- üìù **Detailed Logging**: Complete audit trail of all email attempts\n- üß™ **Test Email Functionality**: Send test emails to verify setup\n\n## Setup\n\n### 1. Environment Variables\n\nMake sure your `.env` file contains the following variables:\n\n```env\nSENDGRID_API_KEY=your_sendgrid_api_key_here\nFROM_EMAIL=your_sender_email@domain.com\nTO_EMAIL=your_recipient_email@domain.com\n```\n\n### 2. Installation\n\nThe debugging tools are automatically available when you have the required dependencies:\n\n```bash\npip install sendgrid python-dotenv jinja2\n```\n\n## Quick Start\n\n### Test Your Email Configuration\n\n```bash\n# Test configuration\npython test_email.py config\n\n# Send a test email\npython test_email.py test\n\n# Run all tests\npython test_email.py all\n```\n\nOr use the batch file:\n\n```cmd\ntest_email.bat config\ntest_email.bat test\ntest_email.bat all\n```\n\n## Usage Examples\n\n### 1. Processing Images with Email Notifications\n\n```bash\n# Process single image with email\npython tools/enhanced_extract_trade.py trade_screenshot.png --send-email\n\n# Process folder of images with email\npython tools/enhanced_extract_trade.py screenshots/ --batch --send-email\n```\n\n### 2. Using the MCP Server\n\nThe MCP server now includes email tools:\n\n- `extract_trade_from_image` - Now supports `send_email` parameter\n- `send_test_email` - Send a test email\n- `get_email_stats` - Get email statistics\n- `check_email_config` - Check email configuration\n\n### 3. Programmatic Usage\n\n```python\nfrom email_utils.sendgrid_client import send_trade_email, send_test_email\nfrom debug_tools.email_debugger import email_debugger\n\n# Send a test email\nresult = send_test_email(\"Hello from my trading system!\")\nprint(f\"Email sent: {result['success']}\")\n\n# Check email statistics\nstats = email_debugger.get_email_stats()\nprint(f\"Success rate: {stats['success_rate']}%\")\n\n# Check configuration\nconfig = email_debugger.check_email_config()\nprint(f\"Config complete: {config['config_complete']}\")\n```\n\n## Email Debugging Commands\n\n### Test Email Script Commands\n\n| Command | Description |\n|---------|-------------|\n| `config` | Test email configuration and show status |\n| `test` | Send a simple test email |\n| `sample` | Send a sample trade email with AI summary |\n| `stats` | Show email sending statistics |\n| `debug` | Show comprehensive debug information |\n| `all` | Run all tests and checks |\n\n### Examples\n\n```bash\n# Check if email is configured correctly\npython test_email.py config\n\n# Send a test email\npython test_email.py test\n\n# Send a sample trade email\npython test_email.py sample\n\n# View email statistics\npython test_email.py stats\n\n# Get comprehensive debug info\npython test_email.py debug\n```\n\n## Understanding Email Status\n\n### Success Indicators\n\n- ‚úÖ **Email sent successfully**: The email was accepted by SendGrid\n- üìß **Status Code 202**: SendGrid accepted the email for delivery\n- üìä **Logged in statistics**: Attempt recorded in debug logs\n\n### Failure Indicators\n\n- ‚ùå **Configuration errors**: Missing API keys or email addresses\n- üö´ **SendGrid errors**: API errors, invalid keys, or service issues\n- üìù **Template errors**: Issues with email template rendering\n- üîó **Network errors**: Connection issues or timeouts\n\n## Log Files\n\nThe system creates several log files to help with debugging:\n\n- `logs/email_debug.jsonl` - Detailed email attempt logs (JSON format)\n- `logs/email_debug.log` - Human-readable email debug logs\n- `logs/trade_summary.log` - AI trade summary generation logs\n\n## Troubleshooting\n\n### Common Issues\n\n1. **\"Missing required environment variables\"**\n   - Check your `.env` file has all required variables\n   - Run `python test_email.py config` to verify\n\n2. **\"Email functionality not available\"**\n   - Install required packages: `pip install sendgrid`\n   - Check that `email_utils` folder exists\n\n3. **SendGrid API errors**\n   - Verify your SendGrid API key is valid\n   - Check that your sender email is verified in SendGrid\n   - Ensure your account has sending permissions\n\n4. **Template rendering errors**\n   - Check that `email_utils/templates/trade_email.html` exists\n   - Verify template syntax is correct\n\n### Debug Steps\n\n1. **Check Configuration**\n   ```bash\n   python test_email.py config\n   ```\n\n2. **View Debug Information**\n   ```bash\n   python test_email.py debug\n   ```\n\n3. **Check Recent Attempts**\n   ```bash\n   python test_email.py stats\n   ```\n\n4. **Test with Simple Email**\n   ```bash\n   python test_email.py test\n   ```\n\n## Email Template\n\nThe system uses a Jinja2 template located at `email_utils/templates/trade_email.html`. You can customize this template to change the email format.\n\n### Template Variables Available\n\n- `trade` - Complete trade data object\n- `summary` - AI-generated trade summary\n- `date` - Trade date/time\n\n## API Integration\n\n### SendGrid Integration\n\nThe system integrates with SendGrid's v3 API:\n\n- Uses `sendgrid` Python library\n- Supports HTML email templates\n- Provides detailed response logging\n- Handles errors gracefully\n\n### Response Codes\n\n- `202` - Accepted (success)\n- `400` - Bad request (check data)\n- `401` - Unauthorized (check API key)\n- `403` - Forbidden (check permissions)\n- `413` - Payload too large\n- `429` - Rate limit exceeded\n\n## Monitoring and Alerts\n\n### Email Statistics\n\nThe system tracks:\n- Total email attempts\n- Success/failure counts\n- Success rate percentage\n- Recent attempt details\n- Error patterns\n\n### Log Monitoring\n\nMonitor these files for issues:\n- `logs/email_debug.log` - Real-time email debug info\n- `logs/trade_summary.log` - AI summary generation\n\n## Best Practices\n\n1. **Test First**: Always test email configuration before going live\n2. **Monitor Logs**: Regularly check email debug logs\n3. **Handle Failures**: Design your workflow to handle email failures gracefully\n4. **Rate Limits**: Be aware of SendGrid rate limits\n5. **Template Testing**: Test email templates with sample data\n\n## Advanced Usage\n\n### Custom Email Messages\n\n```python\nfrom email_utils.sendgrid_client import send_trade_email\nfrom email_utils.trade_summary import summarize_trade\n\n# Custom trade data\ntrade_data = {\n    'trade_id': 'CUSTOM-001',\n    'ticker': 'AAPL',\n    'direction': 'long',\n    'pnl_amount': 150.00\n}\n\n# Generate AI summary\nsummary = summarize_trade(trade_data)\n\n# Send email\nresult = send_trade_email(trade_data, summary)\nprint(f\"Email status: {result['success']}\")\n```\n\n### Batch Email Processing\n\n```python\nfrom tools.enhanced_extract_trade import process_multiple_images\n\n# Process folder with email notifications\nresult = process_multiple_images(\n    folder=\"screenshots/\",\n    save_mode=\"both\",\n    send_email=True\n)\n\nprint(f\"Emails sent: {result['emails_sent']}\")\nprint(f\"Email failures: {result['email_failures']}\")\n```\n\n## Support\n\nIf you encounter issues:\n\n1. Run the debug command: `python test_email.py debug`\n2. Check the log files in the `logs/` directory\n3. Verify your SendGrid account and API key\n4. Test with a simple email first\n\nThe debugging tool provides comprehensive information to help identify and resolve email delivery issues quickly.\n